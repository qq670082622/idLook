//
//  VideoListPopV.m
//  IDLook
//
//  Created by Mr Hu on 2018/10/12.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "VideoListPopV.h"

@interface VideoListPopV ()
@property (nonatomic,strong)UIView *maskV;
@property (nonatomic,strong)UIImageView *selectV;
@end

@implementation VideoListPopV

- (id)init
{
    if(self=[super init])
    {
        
    }
    return self;
}

- (void)showWithLoad:(BOOL)isLoading withSelect:(NSInteger)select
{
    UIWindow *showWindow = nil;
    NSEnumerator *frontToBackWindows = [[[UIApplication sharedApplication]windows]reverseObjectEnumerator];
    
    for (UIWindow *window in frontToBackWindows)
    {
        if (window.windowLevel == UIWindowLevelNormal)
        {
            showWindow = window;
            break;
        }
    }
    if(!showWindow)return;
    
    //当window上有视图时移除
    for (UIView *view in showWindow.subviews) {
        if ([view isKindOfClass:[VideoListPopV class]]) {
            VideoListPopV *popV = (VideoListPopV*)view;
            [popV hide];
            return;
        }
    }
    
    if (isLoading==NO) {
        return;
    }
    
    self.frame=CGRectMake(0,SafeAreaTopHeight+45, showWindow.bounds.size.width, showWindow.bounds.size.height-SafeAreaTopHeight-45);
    self.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:.5f];
    
    UIView *maskV = [[UIView alloc] initWithFrame:CGRectMake(0,-125,UI_SCREEN_WIDTH, 125)];
    maskV.backgroundColor = [UIColor whiteColor];
    maskV.alpha = 0.f;

    UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(hide)];
    tap.numberOfTapsRequired = 1;
    [self addGestureRecognizer:tap];
    [showWindow addSubview:self];
    [self addSubview:maskV];
    self.clipsToBounds=YES;
    self.maskV=maskV;
    
    [self initUIWithSelect:select];
    
    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:.25];
    [UIView setAnimationCurve:7];
    
    maskV.alpha = 1.f;
    
    self.maskV.frame = CGRectMake(0,0, UI_SCREEN_WIDTH,125);
    
    [UIView commitAnimations];
}


- (void)clearSubV
{
    [self removeFromSuperview];
    [self.maskV removeFromSuperview];
}
- (void)hide
{
    //    [self clearSubV];
    
    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:.25];
    [UIView setAnimationCurve:7];
    
    [UIView setAnimationDelegate:self];
    [UIView setAnimationDidStopSelector:@selector(clearSubV)];
    self.alpha = 0.f;
    
    self.maskV.frame = CGRectMake(0,-125, UI_SCREEN_WIDTH, 125);
    
    [UIView commitAnimations];
}

-(void)initUIWithSelect:(NSInteger)select
{
    NSArray *array = @[@"综合排序",@"按竞争力从高到低",@"按颜值从高到低"];
    for (int i =0; i<3; i++) {
        UIView *view = [[UIView alloc]init];view.userInteractionEnabled=YES;
        [self.maskV addSubview:view];
        view.tag=1000+i;
        [view mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(self.maskV);
            make.right.mas_equalTo(self.maskV);
            make.top.mas_equalTo(self.maskV).offset(125/3*i);
            make.height.mas_equalTo(125/3);
        }];
        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(selectAction:)];
        [view addGestureRecognizer:tap];
        
        UILabel *titleLab = [[UILabel alloc] init];
        titleLab.font = [UIFont systemFontOfSize:14.0];
        titleLab.tag=10000+i;
        titleLab.textColor = [UIColor colorWithHexString:@"#666666"];
        [self.maskV addSubview:titleLab];
        [titleLab mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(view).offset(28);
            make.centerY.mas_equalTo(view);
        }];
        titleLab.text=array[i];
        if (i==select) {
            titleLab.textColor=Public_Red_Color;
            
            UIImageView *imageV=[[UIImageView alloc]init];
            imageV.image=[UIImage imageNamed:@"regist_choose"];
            [self.maskV addSubview:imageV];
            [imageV mas_makeConstraints:^(MASConstraintMaker *make) {
                make.right.mas_equalTo(self.maskV).offset(-24);
                make.centerY.mas_equalTo(view);
            }];
            self.selectV=imageV;
        }
    }
}

-(void)selectAction:(UITapGestureRecognizer*)tap
{
    for (int i=0; i<3; i++) {
        UILabel *lab =(UILabel*)[self.maskV viewWithTag:10000+i];
        if (i==tap.view.tag-1000) {
            lab.textColor=Public_Red_Color;
        }
        else
        {
            lab.textColor = [UIColor colorWithHexString:@"#666666"];
        }
    }
    
    [self.selectV mas_remakeConstraints:^(MASConstraintMaker *make) {
        make.centerY.mas_equalTo(tap.view);
        make.right.mas_equalTo(self.maskV).offset(-24);
    }];
    
    if (self.compClickBlock) {
        self.compClickBlock(tap.view.tag-1000);
    }
    [self hide];
}


@end
