//
//  PlaceAuditionOrderVC.m
//  IDLook
//
//  Created by Mr Hu on 2018/10/16.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "PlaceAuditionOrderVC.h"
#import "TZImagePickerController.h"
#import <Photos/Photos.h>
#import "PlaceOrderCustomCell.h"
#import "PlaceOrderHeadV.h"
#import "BirthSelectV.h"
#import "PlaceOrderCellB.h"
#import "PlaceAuditCellB.h"
#import "PlaceAuditCellC.h"
#import "PlaceAuditCellD.h"
#import "PlaceAuditCellE.h"
#import "EditStructM.h"
#import "CenterCustomCell.h"
#import "PriceBottomVA.h"
#import "PublicWebVC.h"
#import "PayWaysVC.h"
#import "ShotStepCellC.h"
#import "DatePickPopV.h"
#import "OrderPickerPopV.h"
#import "CitySelectStep1.h"

@interface PlaceAuditionOrderVC ()<UITableViewDelegate,UITableViewDataSource,UIImagePickerControllerDelegate,UINavigationControllerDelegate,TableVTouchDelegate,PlaceAuditCellECDelegate,TZImagePickerControllerDelegate>
@property(nonatomic,strong)TouchTableV *tableV;
@property(nonatomic,strong)NSMutableArray *dataSource;
@property(nonatomic,strong)NSIndexPath *indexPath;
@property(nonatomic,strong)PriceBottomVA *bottomV;
@property(nonatomic,strong)NSMutableArray *photoArray;    //脚本，图片数组
@property(nonatomic,strong)NSMutableArray *selectedAssets; //脚本，图片数组

@end

@implementation PlaceAuditionOrderVC

-(void)dealloc
{
    [[NSNotificationCenter defaultCenter] removeObserver:self
                                                    name:UIKeyboardWillChangeFrameNotification
                                                  object:nil];
}

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    self.view.backgroundColor=Public_Background_Color;
    
    [self.navigationItem setTitleView:[CustomNavVC setDefaultNavgationItemTitle:@"试镜下单"]];
    
    [self.navigationItem setLeftBarButtonItem:[[UIBarButtonItem alloc] initWithCustomView:[CustomNavVC getLeftDefaultButtonWithTarget:self action:@selector(onGoback)]]];
    
    self.photoArray = [[NSMutableArray alloc]initWithCapacity:0];
    self.selectedAssets=[[NSMutableArray alloc]initWithCapacity:0];
    
    [self getData];
    
    [self bottomV];
    
    [self reloadUIWithWay];
    
    [[NSNotificationCenter defaultCenter] addObserver:self
                                             selector:@selector(keyboardFrameWillChange:)
                                                 name:UIKeyboardWillChangeFrameNotification
                                               object:nil];
}

-(void)onGoback
{
    [self.navigationController popViewControllerAnimated:YES];
}

-(void)getData
{
    self.dataSource =[[NSMutableArray alloc]initWithCapacity:0];
    
    [self.dataSource addObject:@[self.info]];
    [self.dataSource addObject:[PlaceOrderModel getAuditionWay]];
    [self.dataSource addObject:@""];
    [self.dataSource addObject:@[]];
    
    NSDictionary *dic= @{@"title":@"最晚上传作品日期",@"content":@"",@"placeholder":@"请选择最晚上传作品日期",@"isShowArrow":@(YES),@"IsMustInput":@(NO),@"type":@(UserInfoTypeOther)};
    EditStructM *model = [[EditStructM alloc]initWithDic:dic];
    [self.dataSource addObject:model];
    
    [self.dataSource addObject:[PlaceOrderModel getAuditionRequirement]];
    
    [self.dataSource addObject:@""];
    
    if (self.model==nil) {
        return;
    }
    
    {
        OrderStructM *model1 = self.dataSource[1][0];
        OrderStructM *model2 = self.dataSource[1][1];
        
        if (self.model.auditionType==0) {
            model1.isChoose=NO;
            model2.isChoose=YES;
        }
        else if(self.model.auditionType==2)
        {
            model1.isChoose=YES;
            model2.isChoose=NO;
        }
    }
    
    {

    }
}

-(TouchTableV*)tableV
{
    if (!_tableV) {
        _tableV = [[TouchTableV alloc] initWithFrame:CGRectMake(0,0,UI_SCREEN_WIDTH,UI_SCREEN_HEIGHT-SafeAreaTabBarHeight_IphoneX-48) style:UITableViewStyleGrouped];
        _tableV.delegate = self;
        _tableV.dataSource = self;
        _tableV.touchDelegate=self;
        _tableV.showsVerticalScrollIndicator=NO;
        _tableV.showsHorizontalScrollIndicator=NO;
        _tableV.separatorStyle=UITableViewCellSeparatorStyleNone;
        _tableV.autoresizingMask = UIViewAutoresizingFlexibleHeight;
        [self.view addSubview:_tableV];
        _tableV.estimatedRowHeight = 0;
        _tableV.estimatedSectionHeaderHeight = 0;
        _tableV.estimatedSectionFooterHeight = 0;
        _tableV.backgroundColor=[UIColor clearColor];
        _tableV.tableFooterView=[self footV];
    }
    return _tableV;
}



-(PriceBottomVA*)bottomV
{
    if (!_bottomV) {
        _bottomV=[[PriceBottomVA alloc]init];
        [self.view addSubview:_bottomV];
        [_bottomV mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(self.view);
            make.right.mas_equalTo(self.view);
            make.bottom.mas_equalTo(self.view).offset(-SafeAreaTabBarHeight_IphoneX);
            make.height.mas_equalTo(47.5);
        }];
        WeakSelf(self);
        _bottomV.placeOrderBlock  = ^{
            [weakself placeOrderAction];
        };
    }
    return _bottomV;
}

-(UIView*)footV
{
    UIView *footV=[[UIView alloc]initWithFrame:CGRectMake(0, 0, UI_SCREEN_WIDTH, 60)];
    UILabel *lab = [[UILabel alloc] init];
    lab.font = [UIFont systemFontOfSize:13.0];
    lab.textColor = [UIColor colorWithHexString:@"#999999"];
    lab.text=@"售前咨询电话：";
    [footV addSubview:lab];
    [lab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(footV).offset(15);
        make.top.mas_equalTo(footV).offset(15);
    }];
    
    UIButton *phone = [UIButton buttonWithType:UIButtonTypeCustom];
    [phone setTitle:@"400 833 6969" forState:UIControlStateNormal];
    [phone setTitleColor:[UIColor colorWithHexString:@"#75BDFF"] forState:UIControlStateNormal];
    phone.titleLabel.font=[UIFont systemFontOfSize:13.0];
    [footV addSubview:phone];
    [phone mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(lab.mas_right).offset(5);
        make.centerY.mas_equalTo(lab).offset(0);
    }];
    [phone addTarget:self action:@selector(takePhone) forControlEvents:UIControlEventTouchUpInside];
    return footV;
}

//打电话
-(void)takePhone
{
    NSMutableString * str=[[NSMutableString alloc] initWithFormat:@"telprompt:%@",@"400-833-6969"];
    dispatch_async(dispatch_get_global_queue(0, 0), ^{
        [[UIApplication sharedApplication] openURL:[NSURL URLWithString:str]];
    });
}

#pragma mark -
#pragma mark - UITableViewDataSource&&UITableViewDelegate

- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section
{
    return .1f;
}

- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    if (section==0) {
        return 40.f;
    }
    else if (section==4||section==6)
    {
        return 10;
    }
    else if (section==5)
    {
        return 35;
    }
    return 50.f;
}

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    OrderStructM *model1 = self.dataSource[1][0];
    if (model1.isChoose==YES) {
        return 7;
    }
    return 6;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    if (section==1) {
        return 2;
    }
    else if (section==5)
    {
        return 3;
    }
    return 1;
}

-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.section==0) {
        return 80;
    }
    else if (indexPath.section==1)
    {
        return 88;
    }
    else if (indexPath.section==2)
    {
        return 150;
    }
    else if (indexPath.section==3)
    {
        CGFloat height ;
        if(self.photoArray.count<9)
        {
            height=30+(ScriptSubCellWidth+10)*((self.photoArray.count)/3+1);
        }
        else
        {
            height =30+(ScriptSubCellWidth+10)*3;
        }
        return height;
    }
    return 48;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSInteger sec= indexPath.section;
    NSInteger row = indexPath.row;
    
    if (sec==0) {
        static NSString *identifer = @"PlaceAuditCellC";
        PlaceAuditCellC *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[PlaceAuditCellC alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        [cell reloadUIWithInfo:self.info];
        return cell;
    }
    else if (sec==1)
    {
        static NSString *identifer = @"PlaceAuditCellB";
        PlaceAuditCellB *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[PlaceAuditCellB alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        [cell reloadUIWithModel:self.dataSource[indexPath.section][indexPath.row]];
        
        return cell;
    }
    else if (sec==2)
    {
        static NSString *identifer = @"PlaceOrderCellB";
        PlaceOrderCellB *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[PlaceOrderCellB alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        NSString *placeholder=@"请填写项目简介";
        [cell reloadUIWithPlaceholder:placeholder withText:self.dataSource[sec]];
        WeakSelf(self);
        cell.textFieldChangeBlock = ^(NSString *text) {
            [weakself.dataSource replaceObjectAtIndex:indexPath.section withObject:text];
        };
        cell.BeginEdit = ^{
            weakself.indexPath=indexPath;
        };
        return cell;
    }
    else if (sec==3)
    {
        static NSString *identifer = @"PlaceOrderCellE";
        PlaceAuditCellE *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[PlaceAuditCellE alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        cell.delegate=self;
        [cell reloadUIWithArray:self.photoArray withAssets:self.selectedAssets];
        return cell;
    }
    else if (sec==4)
    {
        static NSString *identifer = @"CenterCustomCell";
        CenterCustomCell *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[CenterCustomCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        EditStructM *model = self.dataSource[indexPath.section];
        [cell reloadUIWithModel:model];
        cell.BeginEdit = ^{
        };
        cell.textFieldChangeBlock = ^(NSString *text) {
        };
        return cell;
    }
    else if (sec==5)
    {
        OrderStructM *model=self.dataSource[sec][row];
        if (row==2) {
            static NSString *identifer = @"ShotStepCellC";
            ShotStepCellC *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
            if(!cell)
            {
                cell = [[ShotStepCellC alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
                cell.selectionStyle = UITableViewCellSelectionStyleNone;
                cell.backgroundColor=[UIColor whiteColor];
            }
            [cell reloadUIWithModel:model];
            WeakSelf(self);
            cell.dateSelectWithType = ^(NSInteger type) {
                OrderStructM *model1 = weakself.dataSource[5][0];
                if (type==0) {
                    if (model1.content.length==0) {
                        [SVProgressHUD showImage:nil status:@"请先选择报价天数"];
                        return ;
                    }
                    
                    NSDate *minimumDate = [NSDate date];
                    NSDate *maximumDate = [NSDate dateWithTimeIntervalSinceNow:(24*3600*365*2)];
                    DatePickPopV *popV = [[DatePickPopV alloc]init];
                    [popV showWithMinDate:minimumDate maxDate:maximumDate];
                    popV.dateString = ^(NSString * _Nonnull str) {
                        model.content=str;
                        model.desc=@"";
                        [tableView reloadRowsAtIndexPaths:[NSArray arrayWithObjects:indexPath, nil] withRowAnimation:UITableViewRowAnimationAutomatic];
                    };
                }
                else
                {
                    NSDate *minimumDate = [PublicManager dateFromString1:model.content];
                    if (minimumDate==nil) {
                        [SVProgressHUD showImage:nil status:@"请先选择开始日期"];
                        return ;
                    }
                    NSInteger shotDay=0;
                    if (model1.content.length==2) {
                        NSString *strss=[model1.content substringToIndex:1];
                        shotDay=[strss integerValue];
                    }
                    
                    NSDate *maximumDate = [minimumDate dateByAddingTimeInterval:24*3600*(shotDay+2)];
                    DatePickPopV *popV = [[DatePickPopV alloc]init];
                    [popV showWithMinDate:minimumDate maxDate:maximumDate];
                    popV.dateString = ^(NSString * _Nonnull str) {
                        model.desc=str;
                        [tableView reloadRowsAtIndexPaths:[NSArray arrayWithObjects:indexPath, nil] withRowAnimation:UITableViewRowAnimationAutomatic];
                    };
                }
                
            };
            return cell;
        }
        else
        {
            static NSString *identifer = @"PlaceOrderCustomCell";
            PlaceOrderCustomCell *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
            if(!cell)
            {
                cell = [[PlaceOrderCustomCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
                cell.selectionStyle = UITableViewCellSelectionStyleNone;
                cell.backgroundColor=[UIColor whiteColor];
            }
            [cell reloadUIWithModel:model];
            cell.BeginEdit = ^{
            };
            return cell;
        }
    }
    else if (sec==6)
    {
        static NSString *identifer = @"PlaceAuditCellD";
        PlaceAuditCellD *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[PlaceAuditCellD alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        [cell reloadUI];
        return cell;
    }
    else
    {
        static NSString *identifer = @"UITableViewCell";
        UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:identifer];
        if(!cell)
        {
            cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:identifer];
            cell.selectionStyle = UITableViewCellSelectionStyleNone;
            cell.backgroundColor=[UIColor whiteColor];
        }
        return cell;
    }
    return nil;
}

-(UIView*)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section
{
    if (section<4) {
        static NSString *identifer = @"PlaceOrderHeadV";
        PlaceOrderHeadV *headerView = [tableView dequeueReusableHeaderFooterViewWithIdentifier:identifer];
        if(!headerView)
        {
            headerView = [[PlaceOrderHeadV alloc] initWithReuseIdentifier:identifer];
            [headerView.backgroundView setBackgroundColor:[UIColor clearColor]];
        }
        NSString *title=@"";
        if (section==0) {
            title = @"试镜艺人";
        }
        else if (section==1)
        {
            title = @"试镜方式";
        }
        else if (section==2)
        {
            title = @"项目简介";
        }
        else if (section==3)
        {
            title = @"脚本上传";
        }
        [headerView reloadUIWithTitle:title];
        return headerView;
    }
    else if (section==5)
    {
        static NSString *identifer = @"UITableViewHeaderFooterView";
        UITableViewHeaderFooterView *headerView = [tableView dequeueReusableHeaderFooterViewWithIdentifier:identifer];
        if(!headerView)
        {
            headerView = [[UITableViewHeaderFooterView alloc] initWithReuseIdentifier:identifer];
            [headerView.backgroundView setBackgroundColor:[UIColor clearColor]];
            
            UILabel *label = [[UILabel alloc] init];
            label.lineBreakMode = NSLineBreakByCharWrapping;
            label.numberOfLines = 0;
            label.font = [UIFont systemFontOfSize:13.0];
            label.textColor = [UIColor colorWithHexString:@"#999999"];
            [headerView addSubview:label];
            label.text=@"广告拍摄附加说明";
            [label mas_makeConstraints:^(MASConstraintMaker *make) {
                make.edges.mas_equalTo(headerView).insets(UIEdgeInsetsMake(0, 10, 0, 10));
            }];
        }
        return headerView;
    }
    else
    {
        return nil;
    }

}


-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    [tableView deselectRowAtIndexPath:indexPath animated:YES];
    NSInteger sec= indexPath.section;
    NSInteger row = indexPath.row;
    if (sec==1) {   //试镜方式
        
        for (int i =0;i<[self.dataSource[indexPath.section] count]; i++) {
            OrderStructM *model = self.dataSource[indexPath.section][i];
            model.isChoose=NO;
        }
        
        OrderStructM *model = self.dataSource[sec][row];
        model.isChoose=!model.isChoose;
        [self reloadUIWithWay];
    }
    else if (sec==4)
    {
        EditStructM *model = self.dataSource[indexPath.section];
        BirthSelectV *birthV = [[BirthSelectV alloc] init];
        birthV.didSelectDate = ^(NSString *dateStr){
            model.content=dateStr;
            [tableView reloadRowsAtIndexPaths:[NSArray arrayWithObjects:indexPath, nil] withRowAnimation:UITableViewRowAnimationAutomatic];
        };
        [birthV showWithString:model.content withType:DateTypeDay];
    }
    else if (sec==5)
    {
        OrderStructM *model = self.dataSource[sec][row];
        if (row==0) {
            OrderPickerPopV *pickerV = [[OrderPickerPopV alloc] init];
            pickerV.title=model.title;
            pickerV.didSelectBlock = ^(NSString *select,NSInteger type) {
                model.content=select;
                model.type=type;
                [tableView reloadRowsAtIndexPaths:[NSArray arrayWithObjects:indexPath, nil] withRowAnimation:UITableViewRowAnimationAutomatic];
            };
            [pickerV showWithPickerType:OrderCheckTypeDays withDesc:model.content];
        }
        else if (row==1)
        {
            NSArray  *array = [NSArray array];  //选中的传入
            if (model.content.length) {
                array=[model.content componentsSeparatedByString:@"、"];
            }
            CitySelectStep1 *step1 = [[CitySelectStep1 alloc]init];
            step1.artistRegin=self.info.region;
            step1.selectedArr=array;
            step1.selectCity = ^(NSString *city) {
                model.content=city;
                [tableView reloadRowsAtIndexPaths:[NSArray arrayWithObjects:indexPath, nil] withRowAnimation:UITableViewRowAnimationAutomatic];
            };
            [self.navigationController pushViewController:step1 animated:YES];
        }
    }
    else if (sec==6)
    {
        //http://page.idlook.com/public/protocol/html/index.html?num_id=   正式
        //http://www.pre.idlook.com/public/protocol/html/index.html?num_id=  测试
        PublicWebVC * webVC = [[PublicWebVC alloc] initWithTitle:@"保单详情" url:[NSString stringWithFormat:@"http://www.idlook.com/public/protocol/html/index.html?num_id=%@",self.model.policynum]];
        [self.navigationController pushViewController:webVC animated:YES];
    }
}

-(void)scrollViewDidScroll:(UIScrollView *)scrollView
{
    //    [self.view endEditing:YES];
}

-(void)reloadUIWithWay
{
    for (int i =0;i<[self.dataSource[1] count]; i++) {
        OrderStructM *model = self.dataSource[1][i];
        if (model.isChoose==YES) {
            [self.bottomV reloadUIWithPrice:model.price WithType:0];
        }
    }
    [self.tableV reloadData];
}

#pragma mark -
#pragma mark - TableVTouchDelegate
- (void)tableView:(UITableView *)tableView touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    [self.view endEditing:YES];
}

-(void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event
{
    [self.view endEditing:YES];
}

#pragma mark---
#pragma 下单
-(void)placeOrderAction
{
    NSInteger auditionWay=-1;
    NSString *price = @"";
    for (int i =0;i<[self.dataSource[1] count]; i++)
    {
        OrderStructM *model = self.dataSource[1][i];
        if (model.isChoose)
        {
            if (i==0) {
                auditionWay=2;
            }
            else if (i==1)
            {
                auditionWay=0;
            }
            price=model.price;
        }
    }
    
    if (auditionWay<0) {
        [SVProgressHUD showImage:nil status:@"请选择试镜方式！"];
        return;
    }
    
    NSMutableArray *array = [NSMutableArray new];
    for (int i=0;i<[self.dataSource[0]count]; i++) {
        UserInfoM *info =self.dataSource[0][i];
        [array addObject:info.UID];
    }
    
    NSString *desc = self.dataSource[2];
    if (desc.length==0) {
        [SVProgressHUD showImage:nil status:@"请填写项目简介"];
        return;
    }
    
    EditStructM *model = self.dataSource[4];
    if (model.content.length==0) {
        [SVProgressHUD showImage:nil status:@"请选择最晚上传作品日期"];
        return;
    }
    
    for (int i=0; i<[self.dataSource[5]count];i++) {
        OrderStructM *model11=self.dataSource[5][i];
        if (model11.content.length==0) {
            [SVProgressHUD showImage:nil status:[NSString stringWithFormat:@"请选择%@",model11.title]];
            return;
        }
    }
    
    OrderStructM *model1=self.dataSource[5][0];
    OrderStructM *model2=self.dataSource[5][1];
    OrderStructM *model3=self.dataSource[5][2];
    if(model3.content.length==0 || model3.desc.length==0) {
        [SVProgressHUD showImage:nil status:@"请选择拍摄日期"];
        return;
    }

    NSInteger shotDay=0;
    if (model1.content.length==2) {
        NSString *strss=[model1.content substringToIndex:1];
        shotDay=[strss integerValue];
    }
    
    [SVProgressHUD showWithStatus:@"正在下单，请稍后." maskType:SVProgressHUDMaskTypeClear];
    NSString *tempString = [array componentsJoinedByString:@","];//分隔符逗号
    NSDictionary *dic = @{@"userid":[UserInfoManager getUserUID],
                          @"artistid":tempString,
                          @"auditiontype":@(auditionWay),
                          @"desc":desc,                      //简介
                          @"latestwork":model.content,      //最晚上传日期
                          @"shootdays":@(shotDay),           //拍摄天数
                          @"shootplace":model2.content,     //拍摄地点
                          @"shoottime":model3.content,     //拍摄日期
                          @"shoottimeend":model3.desc,    //拍摄截止日期
                          @"price":price,
                          @"totalprice":price};
    [AFWebAPI placeOrderAudition:dic imageArray:self.photoArray callBack:^(BOOL success, id object) {
        if (success) {
            [SVProgressHUD showSuccessWithStatus:@"下单成功!"];
           
            OrderModel *model = [[OrderModel alloc]initWithDic:[object objectForKey:JSON_data]];
            PayWaysVC *payVC=[[PayWaysVC alloc]init];
            payVC.orderModel=model;
            WeakSelf(self);
            payVC.refreshData = ^{
                 [weakself onGoback];
            };
            [self.navigationController pushViewController:payVC animated:YES];
        }
        else
        {
            AF_SHOW_RESULT_ERROR
        }
    }];
}

#pragma mark--keyboard Noti
- (void)keyboardFrameWillChange:(NSNotification*)notification
{
    CGRect rect = [notification.userInfo[UIKeyboardFrameEndUserInfoKey] CGRectValue];
    
    //当前Cell在屏幕中的坐标值
    CGRect rectInTableView = [self.tableV rectForRowAtIndexPath:self.indexPath];
    CGRect cellRect = [self.tableV convertRect:rectInTableView toView:[self.tableV superview]];
    
    if (rect.origin.y-120-cellRect.origin.y<0) {
        [self.tableV setContentOffset:CGPointMake(0,-rect.origin.y+cellRect.origin.y+120+self.tableV.contentOffset.y) animated:YES];
    }
}

#pragma mark--
#pragma mark---PlaceAuditCellECDelegate
-(void)addVideAction   //才艺作品添加视频
{
    
    TZImagePickerController *imagePickerVc = [[TZImagePickerController alloc] initWithMaxImagesCount:9 columnNumber:4 delegate:self pushPhotoPickerVc:YES];
    // imagePickerVc.navigationBar.translucent = NO;
    imagePickerVc.selectedAssets = self.selectedAssets;
    
  #pragma mark - 五类个性化设置，这些参数都可以不传，此时会走默认设置
    imagePickerVc.isSelectOriginalPhoto = YES;
    imagePickerVc.allowTakePicture = NO; // 在内部显示拍照按钮
    imagePickerVc.allowTakeVideo = NO;   // 在内部显示拍视频按
    [imagePickerVc setUiImagePickerControllerSettingBlock:^(UIImagePickerController *imagePickerController) {
        imagePickerController.videoQuality = UIImagePickerControllerQualityTypeHigh;
    }];
    imagePickerVc.iconThemeColor = [UIColor colorWithRed:31 / 255.0 green:185 / 255.0 blue:34 / 255.0 alpha:1.0];
    imagePickerVc.showPhotoCannotSelectLayer = YES;
    imagePickerVc.cannotSelectLayerColor = [[UIColor whiteColor] colorWithAlphaComponent:0.8];
    [imagePickerVc setPhotoPickerPageUIConfigBlock:^(UICollectionView *collectionView, UIView *bottomToolBar, UIButton *previewButton, UIButton *originalPhotoButton, UILabel *originalPhotoLabel, UIButton *doneButton, UIImageView *numberImageView, UILabel *numberLabel, UIView *divideLine) {
        [doneButton setTitleColor:[UIColor redColor] forState:UIControlStateNormal];
    }];
    
    // 3. Set allow picking video & photo & originalPhoto or not
    // 3. 设置是否可以选择视频/图片/原图
    imagePickerVc.allowPickingVideo = NO;
    imagePickerVc.allowPickingImage = YES;
    imagePickerVc.allowPickingOriginalPhoto = NO;
    imagePickerVc.allowPickingGif = NO;
    imagePickerVc.allowPickingMultipleVideo = NO; // 是否可以多选视频
    
    // 4. 照片排列按修改时间升序
    imagePickerVc.sortAscendingByModificationDate = YES;
    
    imagePickerVc.statusBarStyle = UIStatusBarStyleLightContent;
    
    // 设置是否显示图片序号
    imagePickerVc.showSelectedIndex = NO;
    
    // 设置首选语言 / Set preferred language
    imagePickerVc.preferredLanguage = @"zh-Hans";
    
#pragma mark - 到这里为止
    
    // You can get the photos by block, the same as by delegate.
    // 你可以通过block或者代理，来得到用户选择的照片.
    [imagePickerVc setDidFinishPickingPhotosHandle:^(NSArray<UIImage *> *photos, NSArray *assets, BOOL isSelectOriginalPhoto) {
        [self.photoArray setArray:photos];
        [self.selectedAssets setArray:assets];
        [self.tableV reloadData];
    }];
    [self presentViewController:imagePickerVc animated:YES completion:nil];
}

//删除视频
-(void)delectActionWithRow:(NSInteger)row
{
    if (self.photoArray.count>row) {
        [self.photoArray removeObjectAtIndex:row];
        [self.selectedAssets removeObjectAtIndex:row];
        
        [self.tableV reloadData];
    }
}

@end
