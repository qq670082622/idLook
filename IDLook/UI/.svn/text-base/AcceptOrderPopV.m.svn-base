//
//  AcceptOrderPopV.m
//  IDLook
//
//  Created by HYH on 2018/7/13.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "AcceptOrderPopV.h"

@interface AcceptOrderPopV ()
@property (nonatomic,strong)UIButton *agreeBtn;
@end

@implementation AcceptOrderPopV

- (id)init
{
    self = [super init];
    if(self)
    {
        self.backgroundColor =[[UIColor blackColor] colorWithAlphaComponent:0.5];
        self.hidden = YES;
        self.alpha = 0.0;
        
    }
    return self;
}

-(void)show
{
    NSEnumerator *frontToBackWindows=[[[UIApplication sharedApplication]windows]reverseObjectEnumerator];UIWindow *showWindow = nil;
    for (UIWindow *window in frontToBackWindows)
    {
        if (window.windowLevel == UIWindowLevelNormal)
        {
            showWindow = window;
            break;
        }
    }
    [showWindow addSubview:self];
    
    [self mas_makeConstraints:^(MASConstraintMaker *make) {
        make.edges.mas_equalTo(showWindow).insets(UIEdgeInsetsZero);
    }];
    
    [self creatClickLayout];
    
    self.hidden = NO;
    [UIView animateWithDuration:0.3 animations:^{
        self.alpha = 1.0;
    }];
    
}

- (void)hide
{
    
    [UIView animateWithDuration:0.3 animations:^{
        self.alpha = 0.0;
    } completion:^(BOOL finished) {
        if(self.superview)
        {
            [self removeFromSuperview];
        }
    }];
}


-(void)creatClickLayout
{
    UIView *bg=[[UIView alloc]init];
    bg.backgroundColor=[UIColor whiteColor];
    bg.layer.masksToBounds=YES;
    bg.layer.cornerRadius=5.0;
    [self addSubview:bg];
    [bg mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self);
        make.centerY.mas_equalTo(self).offset(-20);
        make.size.mas_equalTo(CGSizeMake(300, 370));
    }];
    
    UILabel *titleLab = [[UILabel alloc] init];
    titleLab.font = [UIFont boldSystemFontOfSize:17.0];
    titleLab.textColor = Public_Text_Color;
    [self addSubview:titleLab];
    [titleLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self);
        make.top.mas_equalTo(bg).offset(15);
    }];
    titleLab.text =@"电子协议";
    
    UIView *lineV = [[UIView alloc]init];
    lineV.backgroundColor=[UIColor colorWithHexString:@"#F7F7F7"];
    [self addSubview:lineV];
    [lineV mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(bg);
        make.right.mas_equalTo(bg);
        make.top.mas_equalTo(bg).offset(45);
        make.height.mas_equalTo(0.5);
    }];
    
    UIScrollView *scrollV = [[UIScrollView alloc] initWithFrame:CGRectMake(UI_SCREEN_WIDTH/2-300/2,(UI_SCREEN_HEIGHT/2-20)-370/2+50,300, 370-50-45)];
    scrollV.pagingEnabled=NO;
    scrollV.scrollEnabled = YES;
    scrollV.backgroundColor = [UIColor clearColor];
    scrollV.showsHorizontalScrollIndicator = YES;
    scrollV.showsVerticalScrollIndicator = YES;
    [self addSubview:scrollV];

    
    NSString *content=@"1. 本条所述内容是指用户使用本服务过程中所制作、上载、复制、发布、传播的任何内容，包括但不限于账号头像、名称、用户说明等注册信息及认证资料，或文字、语音、图片、视频、图文等发送、回复或自动回复消息和相关链接页面，以及其他使用账号或本服务所产生的内容。2. 用户的言行不得违反《计算机信息网络国际联网安全保护管理办法》、《互联网信息服务管理办法》、《互联网电子公告服务管理规定》、《维护互联网安全的决定》、《互联网新闻信息服务管理规定》等相关法律规定，用户不得以任何方式利用“爱聊骚”账号或本服务传播如下法律、法规和政策禁止的内容：a. 反对宪法所确定的基本原则的：b. 危害国家安全，泄露国家机密，颠覆国家政权，破坏国家统一的；<br>c. 损害国家荣誉和利益的；<br>d. 煽动民族仇恨、民族歧视，破坏民族团结的；<br>e. 散布谣言，扰乱社会秩序，破坏社会稳定的；<br>f. 散步淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的；<br>g. 侮辱或者诽谤他人，侵害他人合法权益的；<br>h. 煽动非法集合、结社、旅行、示威、聚众打扰社会秩序的；<br>i. 以非法民间组织名义活动的；<br>j. 含有虚假、有害、胁迫、侵害他人隐私、骚扰、侵害、中伤、粗俗、猥琐或其它道德上令人反感的内容；<br>k. 含有中国法律、法规、规章、条例以及任何具有法律效力之规范所限制或禁止的其它内容的。<br>3. 用户不得利用“爱聊骚”账号或本服务以任何形式传播如下干扰“爱聊骚”正常运营，以及侵犯其他用户或第三方合法权益的内容：<br>a. 含有任何性或性暗示的；<br>b. 含有辱骂、恐吓、威胁内容的；<br>c. 含有骚扰、垃圾广告、恶意信息、诱骗信息的；<br>d. 涉及他人隐私、个人信息或资料的；<br>e. 侵害他人名誉权、肖像权、知识产权、商业秘密等合法权利的；<br>f. 含有其他干扰本服务正常运营和侵犯其他用户或第三方合法权益内容的信息。<br>以上行为一经发现，本团队管理人员有权不提前通知作者直接删除，并依照有关规定作相应处罚、情节严重者，本团队管理人员有权对其作出关闭部分权限、暂停直至禁止使用。";
    
    CGFloat height =[self heighOfString:content font:[UIFont systemFontOfSize:14.0] width:300];
    
    MLLabel *contentLab = [[MLLabel alloc] initWithFrame:CGRectMake(0, 0, 300, height)];
    contentLab.font = [UIFont systemFontOfSize:14.0];
    contentLab.numberOfLines=0;
    contentLab.lineSpacing=5.0;
    contentLab.backgroundColor=[UIColor clearColor];
    contentLab.lineBreakMode = NSLineBreakByWordWrapping;
    contentLab.textInsets = UIEdgeInsetsMake(5, 10, 5, 10);
    contentLab.textColor = Public_Text_Color;
    [scrollV addSubview:contentLab];

    contentLab.text =content;
    
    scrollV.contentSize=CGSizeMake(0,height);
    
    UIButton *agreeBtn=[UIButton buttonWithType:UIButtonTypeCustom];
    [agreeBtn setImage:[UIImage imageNamed:@"works_agree_n"] forState:UIControlStateNormal];
    [agreeBtn setImage:[UIImage imageNamed:@"works_agree_h"] forState:UIControlStateSelected];
    [self addSubview:agreeBtn];
    [agreeBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(bg).offset(5);
        make.bottom.mas_equalTo(bg).offset(-10);
        make.size.mas_equalTo(CGSizeMake(30, 30));
    }];
    [agreeBtn addTarget:self action:@selector(agreeAction:) forControlEvents:UIControlEventTouchUpInside];
    self.agreeBtn=agreeBtn;
    
    UILabel *agreeLab= [[UILabel alloc]init];
    agreeLab.text=@"本人同意脸探肖像平台的电子协议";
    agreeLab.font=[UIFont systemFontOfSize:12];
    agreeLab.textColor=[UIColor colorWithHexString:@"#999999"];
    [self addSubview:agreeLab];
    [agreeLab mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.mas_equalTo(agreeBtn);
        make.left.mas_equalTo(agreeBtn.mas_right).offset(0);
    }];
    
    UIButton *closeBtm = [UIButton buttonWithType:UIButtonTypeCustom];
    [closeBtm addTarget:self action:@selector(hide) forControlEvents:UIControlEventTouchUpInside];
    [self addSubview:closeBtm];
    [closeBtm setBackgroundImage:[UIImage imageNamed:@"order_close"] forState:UIControlStateNormal];
    [closeBtm mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.equalTo(bg);
        make.top.equalTo(bg.mas_bottom).offset(25);
    }];
    

    UIButton *acceptBtn=[UIButton buttonWithType:UIButtonTypeCustom];
    [self addSubview:acceptBtn];
    acceptBtn.layer.masksToBounds=YES;
    acceptBtn.layer.cornerRadius=2.0;
    acceptBtn.layer.borderColor=Public_Red_Color.CGColor;
    acceptBtn.layer.borderWidth=0.5;
    [acceptBtn setTitle:@"接单" forState:UIControlStateNormal];
    [acceptBtn setTitleColor:Public_Red_Color forState:UIControlStateNormal];
    acceptBtn.titleLabel.font=[UIFont systemFontOfSize:14.0];
    [acceptBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.mas_equalTo(agreeBtn);
        make.right.mas_equalTo(bg).offset(-10);
        make.size.mas_equalTo(CGSizeMake(75, 30));
    }];
    [acceptBtn addTarget:self action:@selector(receiptAction) forControlEvents:UIControlEventTouchUpInside];
}

//同意协议
-(void)agreeAction:(UIButton*)sender
{
    sender.selected=!sender.selected;
}

-(void)receiptAction
{
    if (self.agreeBtn.selected==NO) {
        [SVProgressHUD showErrorWithStatus:@"请先同意脸探肖像电子协议"];
        return;
    }
    self.acceptOrder();
    [self hide];
}

//文字高度
-(CGFloat)heighOfString:(NSString *)string font:(UIFont *)font width:(CGFloat)width
{
    MLLabel *contentLab = [[MLLabel alloc] init];
    contentLab.font = font;
    contentLab.numberOfLines = 0;
    contentLab.lineBreakMode = NSLineBreakByWordWrapping;
    contentLab.lineSpacing = 5;
    contentLab.textInsets = UIEdgeInsetsMake(5, 10, 5, 10);
    contentLab.text = string;
    CGSize size = [contentLab sizeThatFits:CGSizeMake(width, 0)];
    size.width = fmin(size.width, width);
    
    return ceilf(size.height)<20.0?20.0:ceilf(size.height);
    
}

@end
