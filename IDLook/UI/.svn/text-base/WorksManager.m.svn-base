//
//  WorksManager.m
//  IDLook
//
//  Created by HYH on 2018/5/18.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "WorksManager.h"
#import "WorkCellA.h"
#import "WorkCellB.h"

@implementation WorksManager

#pragma mark -
#pragma mark -UICollectionViewDelegateFlowLayout
-(NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section
{
    return [self.dataM.ds[collectionView.tag-100][section]count];
}

-(NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView
{
    return [self.dataM.ds[collectionView.tag-100]count];
}

-(UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath
{
    WorksModel *model = (WorksModel*) self.dataM.ds[collectionView.tag-100] [indexPath.section][indexPath.row];
    if (collectionView.tag==102 && model.microtype==1)
    {
        WorkCellB *cell = [collectionView dequeueReusableCellWithReuseIdentifier:@"WorkCellB" forIndexPath:indexPath];
        cell.backgroundColor=[UIColor clearColor];
        [cell reloadUIWithModel:model];
        WeakSelf(self);
        cell.chooseAction = ^(BOOL select) {
            weakself.chooseAction(select, indexPath);
        };
        cell.playAction = ^{
            weakself.playAction(model);
        };
        return cell;
    }
    else
    {
        WorkCellA *cell = [collectionView dequeueReusableCellWithReuseIdentifier:@"WorkCellA" forIndexPath:indexPath];
        cell.backgroundColor=[UIColor clearColor];
        [cell reloadUIWithModel:model];
        WeakSelf(self);
        cell.chooseAction = ^(BOOL select) {
            weakself.chooseAction(select, indexPath);
        };
        cell.playAction = ^{
            weakself.playAction(model);
        };
        return cell;
    }
}

-(UICollectionReusableView*)collectionView:(UICollectionView *)collectionView viewForSupplementaryElementOfKind:(NSString *)kind atIndexPath:(NSIndexPath *)indexPath
{
    if ([kind isEqualToString:UICollectionElementKindSectionHeader]) {
        UICollectionReusableView *headView = [collectionView dequeueReusableSupplementaryViewOfKind:UICollectionElementKindSectionHeader withReuseIdentifier:@"headView" forIndexPath:indexPath];
        
        for (UIView *view in headView.subviews) {
            [view removeFromSuperview];
        }
        
        UILabel  *titleLab = [[UILabel alloc] initWithFrame:CGRectMake(15, 20, 100, 30)];
        [headView addSubview:titleLab];
        WorksModel *model = (WorksModel*) self.dataM.ds[collectionView.tag-100] [indexPath.section][indexPath.row];

        titleLab.text=model.type;
        
        [titleLab mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(headView).offset(15);
            make.bottom.mas_equalTo(headView);
        }];
        return  headView;
    }
    else
    {
        return nil;
    }
}


-(void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath
{
    [collectionView deselectItemAtIndexPath:indexPath animated:YES];
}

- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath
{
    if (collectionView.tag==100) {
        return CGSizeMake((UI_SCREEN_WIDTH-45)/2, (UI_SCREEN_WIDTH-45)/2 * (188.0/336.0));
    }
    if (collectionView.tag==102)
    {
        WorksModel *model = (WorksModel*) self.dataM.ds[collectionView.tag-100] [indexPath.section][indexPath.row];
        if (model.microtype==1)
        {
            return CGSizeMake((UI_SCREEN_WIDTH-40)/3, (UI_SCREEN_WIDTH-40)/3*(256.0/220.0)+20);
        }
    }
    return CGSizeMake((UI_SCREEN_WIDTH-45)/2, (UI_SCREEN_WIDTH-45)/2 * (188.0/336.0)+30);
}

-(UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout insetForSectionAtIndex:(NSInteger)section
{

   if (collectionView.tag==102)
    {

        WorksModel *model = (WorksModel*) [self.dataM.ds[collectionView.tag-100][section]firstObject];
        if (model.microtype==1)
        {
            return UIEdgeInsetsMake(15, 9,15,9);
        }
    }
    return UIEdgeInsetsMake(15, 15, 15, 15);
}

-(CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout referenceSizeForHeaderInSection:(NSInteger)section
{
    if (collectionView.tag==101) {
        return CGSizeMake(0,0);
    }
    return CGSizeMake(0,35);
}

@end
