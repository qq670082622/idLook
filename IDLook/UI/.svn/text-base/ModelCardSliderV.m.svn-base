//
//  ModelCardSliderV.m
//  IDLook
//
//  Created by HYH on 2018/5/21.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "ModelCardSliderV.h"

@interface ModelCardSliderV ()
@property (nonatomic,weak) UIButton *selectedBtn;
@end

@implementation ModelCardSliderV

{
    
    UIScrollView *_scView;//类型滚动视图
    
    NSInteger _typeViewIndex;
}

//初始化视图
-(id)initWithFrame:(CGRect)frame
{
    if (self=[super initWithFrame:frame])
    {
        //        [self initUI];//绘制UI

    }
    return self;
}

-(void)setTypeViewArray:(NSArray *)typeViewArray
{
    _typeViewArray=typeViewArray;
    [self initUI];
}

-(void)setIsEdit:(BOOL)isEdit
{
    _isEdit=isEdit;
    for (NSInteger i=0;i<_typeViewArray.count;i++)
    {
        UIButton *btn = [_scView viewWithTag:1000000+i];
        if (isEdit) {
            btn.hidden=NO;
        }
        else
        {
            btn.hidden=YES;

        }
    }
}

//绘制UI
-(void)initUI
{
    for (UIView *view in _scView.subviews) {
        [view removeFromSuperview];
    }
    
    _scView=[[UIScrollView alloc] initWithFrame:CGRectMake(0, 0, self.frame.size.width, 55)];
    _scView.backgroundColor=[UIColor clearColor];
    _scView.scrollEnabled = YES;//设置是否支持滚动
    _scView.showsHorizontalScrollIndicator = NO;//设置是否显示水平滚动条
    [self addSubview:_scView];
    
    CGRect rect=CGRectMake(0, 0, 0, 0);
    UIImage *image=[UIImage imageNamed:@"model_type_normal"];
    for (NSInteger i=0;i<_typeViewArray.count;i++)
    {
        UIButton *btn=[[UIButton alloc] init];
        btn.tag=100000+i;
        [btn setTitle:_typeViewArray[i] forState:UIControlStateNormal];
        [btn.titleLabel setFont:[UIFont systemFontOfSize:15.0]];
        [btn setTitleColor:[UIColor colorWithHexString:@"#666666"] forState:UIControlStateNormal];
        [btn setTitleColor:[UIColor whiteColor] forState:UIControlStateSelected];
        [btn setBackgroundImage:[UIImage imageNamed:@"model_type_normal"] forState:UIControlStateNormal];
        [btn setBackgroundImage:[UIImage imageNamed:@"model_type_click"] forState:UIControlStateSelected];
        [btn addTarget:self action:@selector(typeBtnClick:) forControlEvents:UIControlEventTouchUpInside];
        [btn setFrame:CGRectMake(rect.origin.x+rect.size.width+20,20, image.size.width, image.size.height)];
        btn.selected=NO;
        [_scView addSubview:btn];
        rect=btn.frame;
        
        if (i==0)
        {
            btn.selected=YES;
            [btn.titleLabel setFont:[UIFont boldSystemFontOfSize:15.0]];
            self.selectedBtn=btn;
        }
        
        //删除按钮
        UIButton *delectBtn = [UIButton buttonWithType:UIButtonTypeCustom];
        [delectBtn setTag:1000000+i];
        [_scView addSubview:delectBtn];
        [delectBtn setBackgroundImage:[UIImage imageNamed:@"modelcard_dele"] forState:UIControlStateNormal];
        [delectBtn mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerY.mas_equalTo(btn.mas_top);
            make.centerX.mas_equalTo(btn.mas_right);
        }];
        delectBtn.hidden=YES;
        [delectBtn addTarget:self action:@selector(delectAction:) forControlEvents:UIControlEventTouchUpInside];
    }
    _scView.contentSize = CGSizeMake(rect.origin.x+rect.size.width+20, _scView.frame.size.height);//设置滚动区域大小
    
}

//删除
-(void)delectAction:(UIButton*)sender
{
    if(self.delegate &&[self.delegate respondsToSelector:@selector(delectWithIndex:)])
    {
        [self.delegate delectWithIndex:sender.tag-1000000];
    }
}

//点击了类型btn
-(void)typeBtnClick:(UIButton*)selectedBtn
{
    
    if (selectedBtn == _selectedBtn) {
        return;
    }
    
    //计算scrollview偏移量
    CGFloat originX = selectedBtn.center.x - CGRectGetMidX(_scView.frame);
    CGFloat maxOffsetX = _scView.contentSize.width - _scView.frame.size.width;
    if (originX < 0) {
        originX = 0;
    }else if (originX > maxOffsetX){
        originX = maxOffsetX;
    }
    [_scView setContentOffset:CGPointMake(originX, 0) animated:YES];
    
    [UIView animateWithDuration:0.5 animations:^{
        selectedBtn.selected=YES;
        selectedBtn.titleLabel.font=[UIFont boldSystemFontOfSize:15.0];
        
        self.selectedBtn.selected=NO;
        self.selectedBtn.titleLabel.font=[UIFont systemFontOfSize:14.0];
    }];

    _selectedBtn = selectedBtn;
    
    _typeViewIndex=selectedBtn.tag-100000;
    
    if(self.delegate &&[self.delegate respondsToSelector:@selector(clickTypeViewWithIndex:)])
    {
        [self.delegate clickTypeViewWithIndex:_typeViewIndex];
    }
}

- (void)moveSliderToPage:(NSInteger)page
{
    UIButton *selectedBtn = [_scView viewWithTag:page+100000];

    if (selectedBtn == _selectedBtn) {
        return;
    }
    
    //计算scrollview偏移量
    CGFloat originX = selectedBtn.center.x - CGRectGetMidX(_scView.frame);
    CGFloat maxOffsetX = _scView.contentSize.width - _scView.frame.size.width;
    if (originX < 0) {
        originX = 0;
    }else if (originX > maxOffsetX){
        originX = maxOffsetX;
    }
    [_scView setContentOffset:CGPointMake(originX, 0) animated:YES];
    
    [UIView animateWithDuration:0.5 animations:^{
        selectedBtn.selected=YES;
        selectedBtn.titleLabel.font=[UIFont boldSystemFontOfSize:15.0];
        
        self.selectedBtn.selected=NO;
        self.selectedBtn.titleLabel.font=[UIFont systemFontOfSize:14.0];
    }];
    
    _selectedBtn = selectedBtn;
}

@end
