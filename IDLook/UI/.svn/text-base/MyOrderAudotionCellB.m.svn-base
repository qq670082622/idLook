//
//  MyOrderAudotionCellB.m
//  IDLook
//
//  Created by HYH on 2018/7/12.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "MyOrderAudotionCellB.h"

@interface MyOrderAudotionCellB ()
@property(nonatomic,strong)UIImageView *icon;
@property(nonatomic,strong)UILabel *titleLab;
@property(nonatomic,strong)UILabel *desc1;
@property(nonatomic,strong)UILabel *desc2;
@property(nonatomic,strong)UIButton *receiptBtn;  //接单
@property(nonatomic,strong)UIButton *refusalBtn;  //拒单
@property(nonatomic,strong)UILabel *priceLab;

@property(nonatomic,strong)UILabel *rejectReson;  //拒单理由

@end

@implementation MyOrderAudotionCellB

-(id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier
{
    if (self=[super initWithStyle:style reuseIdentifier:reuseIdentifier]) {
        
    }
    return self;
}

-(UIImageView*)icon
{
    if (!_icon) {
        _icon=[[UIImageView alloc]init];
        _icon.layer.masksToBounds=YES;
        _icon.layer.cornerRadius=4.0;
        _icon.contentMode=UIViewContentModeScaleAspectFill;
        [self.contentView addSubview:_icon];
        [_icon mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(self.centerV).offset(15);
            make.centerY.mas_equalTo(self.centerV);
            make.size.mas_equalTo(CGSizeMake(75, 75));
        }];
    }
    return _icon;
}

-(UILabel*)titleLab
{
    if (!_titleLab) {
        _titleLab=[[UILabel alloc]init];
        _titleLab.numberOfLines=1;
        _titleLab.font=[UIFont systemFontOfSize:14.0];
        _titleLab.textColor=Public_Text_Color;
        [self.contentView addSubview:_titleLab];
        [_titleLab mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.mas_equalTo(self.centerV).offset(20);
            make.left.mas_equalTo(self.icon.mas_right).offset(15);
            make.right.mas_equalTo(self.contentView).offset(-10);
        }];
    }
    return _titleLab;
}

-(UILabel*)desc1
{
    if (!_desc1) {
        _desc1=[[UILabel alloc]init];
        _desc1.numberOfLines=1;
        _desc1.font=[UIFont systemFontOfSize:12.0];
        _desc1.textColor=[UIColor colorWithHexString:@"#999999"];
        [self addSubview:_desc1];
        [_desc1 mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(self.icon.mas_right).offset(15);
            make.top.mas_equalTo(self.titleLab.mas_bottom).offset(10);
            make.right.mas_equalTo(self.contentView).offset(-10);
        }];
    }
    return _desc1;
}

-(UILabel*)desc2
{
    if (!_desc2) {
        _desc2=[[UILabel alloc]init];
        _desc2.numberOfLines=1;
        _desc2.font=[UIFont systemFontOfSize:12.0];
        _desc2.textColor=[UIColor colorWithHexString:@"#999999"];
        [self addSubview:_desc2];
        [_desc2 mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(self.icon.mas_right).offset(15);
            make.top.mas_equalTo(self.desc1.mas_bottom).offset(5);
            make.right.mas_equalTo(self.contentView).offset(-10);
        }];
    }
    return _desc2;
}

//接单
-(UIButton*)receiptBtn
{
    if (!_receiptBtn) {
        _receiptBtn=[UIButton buttonWithType:UIButtonTypeCustom];
        [self.contentView addSubview:_receiptBtn];
        _receiptBtn.layer.masksToBounds=YES;
        _receiptBtn.layer.cornerRadius=2.0;
        _receiptBtn.layer.borderColor=Public_Red_Color.CGColor;
        _receiptBtn.layer.borderWidth=0.5;
        [_receiptBtn setTitle:@"接单" forState:UIControlStateNormal];
        [_receiptBtn setTitleColor:Public_Red_Color forState:UIControlStateNormal];
        _receiptBtn.titleLabel.font=[UIFont systemFontOfSize:14.0];
        [_receiptBtn mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerY.mas_equalTo(self.contentView.mas_bottom).offset(-20);
            make.right.mas_equalTo(self.contentView).offset(-15);
            make.size.mas_equalTo(CGSizeMake(75, 27));
        }];
        [_receiptBtn addTarget:self action:@selector(receiptAction) forControlEvents:UIControlEventTouchUpInside];
    }
    return _receiptBtn;
}

//拒单
-(UIButton*)refusalBtn
{
    if (!_refusalBtn) {
        _refusalBtn=[UIButton buttonWithType:UIButtonTypeCustom];
        [self.contentView addSubview:_refusalBtn];
        _refusalBtn.layer.masksToBounds=YES;
        _refusalBtn.layer.cornerRadius=2.0;
        _refusalBtn.layer.borderColor=[UIColor colorWithHexString:@"#999999"].CGColor;
        _refusalBtn.layer.borderWidth=0.5;
        [_refusalBtn setTitle:@"拒单" forState:UIControlStateNormal];
        [_refusalBtn setTitleColor:[UIColor colorWithHexString:@"#999999"] forState:UIControlStateNormal];
        _refusalBtn.titleLabel.font=[UIFont systemFontOfSize:14.0];
        [_refusalBtn mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerY.mas_equalTo(self.contentView.mas_bottom).offset(-20);
            make.right.mas_equalTo(self.receiptBtn.mas_left).offset(-10);
            make.size.mas_equalTo(CGSizeMake(75, 27));
        }];
        [_refusalBtn addTarget:self action:@selector(refusalAction) forControlEvents:UIControlEventTouchUpInside];
    }
    return _refusalBtn;
}


-(UILabel*)priceLab
{
    if (!_priceLab) {
        _priceLab=[[UILabel alloc]init];
        _priceLab.font=[UIFont systemFontOfSize:13.0];
        _priceLab.textColor=Public_Text_Color;
        [self addSubview:_priceLab];
        [_priceLab mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerY.mas_equalTo(self.contentView.mas_bottom).offset(-20);
            make.left.mas_equalTo(self.contentView).offset(15);
        }];
    }
    return _priceLab;
}

-(UILabel*)rejectReson
{
    if (!_rejectReson) {
        _rejectReson=[[UILabel alloc]init];
        _rejectReson.font=[UIFont systemFontOfSize:13.0];
        _rejectReson.textColor=[UIColor colorWithHexString:@"#FF6418"];
        _rejectReson.textAlignment=NSTextAlignmentRight;
        [self addSubview:_rejectReson];
        [_rejectReson mas_makeConstraints:^(MASConstraintMaker *make) {
            make.right.mas_equalTo(self.contentView).offset(-15);
            make.left.mas_equalTo(self.contentView).offset(200);
            make.centerY.mas_equalTo(self.contentView.mas_bottom).offset(-20);
        }];
        
    }
    return _rejectReson;
}

-(void)reloadUIWithModel:(OrderModel*)model;
{
    self.orderTimeLab.text=[NSString stringWithFormat:@"下单时间：%@",model.orderdate];
    self.orderStateLab.text=[model getOrderStateWihtOrderInfo:model withUserType:[UserInfoManager getUserType]];

    [self.icon sd_setImageWithUrlStr:model.actorHead placeholderImage:[UIImage imageNamed:@"default_home"]];
    self.titleLab.text=[NSString stringWithFormat:@"%@   %@",model.actorNick,model.projectName];
    self.desc1.text=[NSString stringWithFormat:@"试镜方式：%@",[model getAuditionWayWithType:model.auditionType]];
    self.desc2.text=[NSString stringWithFormat:@"截止日期：%@",model.latestworktime];
    
    NSString *price=[UserInfoManager getUserType]==UserTypePurchaser?model.price:model.profit;
    NSString *str = [NSString stringWithFormat:@"总金额：¥%ld",[price integerValue]];
    NSMutableAttributedString * attStr = [[NSMutableAttributedString alloc] initWithString:str];
    [attStr addAttributes:@{NSForegroundColorAttributeName:Public_Red_Color,NSFontAttributeName:[UIFont systemFontOfSize:16.0]} range:NSMakeRange(4,str.length-4)];
    self.priceLab.attributedText=attStr;
    
    if ([model.orderstate isEqualToString:@"new"]) {
        [self.receiptBtn setTitle:@"付款" forState:UIControlStateNormal];
        self.receiptBtn.hidden=NO;
        self.rejectReson.hidden=YES;
        self.refusalBtn.hidden=YES;
    }
    else if ([model.orderstate isEqualToString:@"rejected"])   //艺人拒单，显示拒单理由
    {
        self.receiptBtn.hidden=YES;
        self.rejectReson.hidden=NO;
        self.refusalBtn.hidden=YES;
        self.rejectReson.text=[NSString stringWithFormat:@"拒单理由：%@",model.ordermsg];
    }

    else if ([model.orderstate isEqualToString:@"videouploaded"])
    {
        [self.receiptBtn setTitle:@"确认完成" forState:UIControlStateNormal];
        self.receiptBtn.hidden=NO;
        self.rejectReson.hidden=YES;
        self.refusalBtn.hidden=YES;
    }
    else if ([model.orderstate isEqualToString:@"finished"])
    {
        [self.receiptBtn setTitle:@"下拍摄订单" forState:UIControlStateNormal];
        self.receiptBtn.hidden=NO;
        self.rejectReson.hidden=NO;
        self.refusalBtn.hidden=YES;
    }
    
    else
    {
        self.receiptBtn.hidden=YES;
        self.rejectReson.hidden=YES;
        self.refusalBtn.hidden=YES;
    }
    
}

#pragma mark---Action
//接单
-(void)receiptAction
{
    if (self.delegate && [self.delegate respondsToSelector:@selector(playAndFinishOrderWithIndexPath:)]) {
        [self.delegate playAndFinishOrderWithIndexPath:self.indexPath];
    }
}

//拒单
-(void)refusalAction
{
    if (self.delegate && [self.delegate respondsToSelector:@selector(buyerAuditOrderWithIndexPath:)]) {
        [self.delegate buyerAuditOrderWithIndexPath:self.indexPath];
    }
}


@end
