//
//  PriceManger.m
//  IDLook
//
//  Created by HYH on 2018/7/18.
//  Copyright © 2018年 HYH. All rights reserved.
//

#import "PriceManger.h"
#import "PriceModel.h"

@implementation PriceManger

-(id)init
{
    if (self=[super init]) {
        [self refreshPriceInfo];
        [self analyzePriceInfoWithArray:nil];
    }
    return self;
}

- (NSMutableArray *)ds
{
    if(!_ds)
    {
        _ds = [NSMutableArray new];
    }
    return _ds;
}


-(void)refreshPriceInfo
{
     [SVProgressHUD showWithMaskType:SVProgressHUDMaskTypeClear];
    NSDictionary *dicArg = @{@"userid":[UserInfoManager getUserUID]};
    [AFWebAPI getQuotaListWithArg:dicArg callBack:^(BOOL success, id object) {
        if (success) {
            [SVProgressHUD dismiss];
            NSArray *array =[object objectForKey:JSON_data];
            [self analyzePriceInfoWithArray:array];
        }
        else
        {
            AF_SHOW_RESULT_ERROR
        }
    }];
}

-(void)analyzePriceInfoWithArray:(NSArray*)array
{
    [self.ds removeAllObjects];
    
    NSMutableArray *sec1 = [NSMutableArray new];
    NSMutableArray *sec2 = [NSMutableArray new];
    NSMutableArray *sec3 = [NSMutableArray new];
    
    for (int i =0; i<array.count; i++) {
        NSDictionary *dic = array[i];
        PriceModel *model = [[PriceModel alloc]initWithDic:dic];
        if (model.type==1) {
            [sec1 addObject:model];
        }
        else if (model.type==2)
        {
            [sec2 addObject:model];
        }
        else if (model.type==3)
        {
            [sec3 addObject:model];
        }
    }
    
    if (sec1.count) {
        [self.ds addObject:@{@"title":@"视频类",@"data":sec1}];
    }
    if (sec2.count) {
        [self.ds addObject:@{@"title":@"平面类",@"data":sec2}];
    }
    if (sec3.count) {
        [self.ds addObject:@{@"title":@"活动类",@"data":sec3}];
    }
    
    if (self.newDataNeedRefreshed) {
        self.newDataNeedRefreshed();
    }
}


@end
